租户管理员能够操作的资源有以下模块

### 规则链库

简单来说，这里的规则引擎就是和 Node-red 中的 flow 流的概念差不多。都是用于处理设备中数据，细分下来大致有以下三种主要组件来构成

* 消息 Message，任何传入的事件，它可以是来自设备，设备生命周期事件，REST API 事件，RPC 请求等的传入数据。
* 规则节点 对传入的消息执行的函数，有许多不同的节点类型可以过滤，转化，或对传入的消息进行某些擦欧洲。
* 规则链节点之间通过线来互相连接，因此来自规则节点的出站消息将发送到下一个连接的规则节点。

进入系统后，点击规则链库图标，或者菜单，进入规则链库的管理页面。点击规则链库表格的某一行，可以打开右侧的抽屉，对其进行编辑。

如我们所见，一共有 6 大类型的节点
* 筛选器 使用配置条件筛选传入的消息
* 属性集 向消息元数据中添加附加信息
* 变换 更改消息 Payload 和元数据
* 动作 执行特别动作
* 外部的 与外部系统交互
* 规则链 将传入的消息发送到指定的规则链
* 有的节点只有输入，没有输入，有的有输入但没有输出。有的节点输入和输出都有。

有的节点只有输入，没有输入，有的有输入但没有输出。有的节点输入和输出都有。 一共节点10+9+3+22+32+1 = 77个节点

看一下使用tb的规则链配置能实现那些功能吧

* 在保存到数据库之前，对传入遥测或属性进行数据验证和修改。
* 将遥测或属性从设备复制到相关资产，以便可以汇总遥测。例如，可以将多个设备中的数据汇总到相关资产中。
* 根据定义的条件创建/更新/清除警报。
* 根据设备生命周期事件触发操作。例如，如果设备处于在线/离线状态，则创建警报。
* 加载处理所需的其他数据。例如，在“设备的客户”或“租户”属性中定义的设备的负载温度阈值。
* 触发对外部系统的REST API调用。
* 发生复杂事件时发送电子邮件，并使用“电子邮件模板”中其他实体的属性。
* 在事件处理期间要考虑用户的偏好。
* 根据定义的条件进行RPC调用。
* 与外部管道（如 Kafka，Spark，AWS 服务等）集成。

### 客户

一个客户可以有这些基本操作

* 管理客户用户
* 管理客户资产
* 管理客户设备
* 管理客户仪表板
* 删除客户

这里补充一下有关平台，租户，客户，用户的概念。

首先 tb 是一个物联网管理平台，这个平台可以让其他企业入驻进来，这些入驻的企业或个人就是租户，他们使用 tb 的服务，可以对资源，设备进行管理。 每一个租户下面又可以有多个客户，这些客户可以直接使用租户配置好的设备、资产。客户才是资产、设备的直接使用者。而客户下面，还有一层，那就是用户，这个用户就是单纯的用户，可以看到设备的一些数据，监控，告警。 所以整个用户体系。从最顶层的平台系统管理员 => 租户 => 【被租户管理的】客户 => 【租户下管理的客户下的】用户 整个使用层级分为四层，可以满足绝大多说的 pass，sass 化场景。

* 系统管理员可以登录
* 租和客户登录
* 用户可以登录

客户下的资源有这些
* 用户
* 资产
* 设备
* 仪表板

可以查看的资源也很多
* 详情
* 属性
* 最新遥测数据
* 警告
* 事件
* 关联
* 审计日志

点击之后就能使用此用户登录系统。 这也是租户管理员的权限之一，可进入任意客户下用户的页面。 点击右上角的加号可以进行添加一个客户用户， 用户的表单如下。

电子邮件是必须要填的，因为登录系统要用，用户的激活方式可以使用激活链接，或者激活邮件二种方式。 要使用邮件，必须要系统管理员先配置好邮件配置。

### 资产管理

资产是指一类设备的统称，绑定在客户名下，归属于设备的一个属性。 目前资产的类型只有 TbServiceQueue 类型，目前还不清楚这个资产类型具体有什么用处。 创建资产的时候，名称和资产类型是必填项。

但是我在保存的时候发现 无法保存。目前猜猜是因为我启动tb是使用本地的消息队列来安装的。导致消息队列无法使用。 目前先留一个坑，后续我再完善补充。

目前可对资产可进行的操作有
*   将资产设置为公开
*   分配给客户

* 如果将资产设置为公开，那么改租户下的所有客户都将看到这个资产。
* 若资产分配给 public 客户的效果也是设置为公开。
* 目前尝试了一个资产只能分配给一个客户。

### 设备管理

首先来讲一下设备配置，设置配置是为了统一类型的设备配置规则链，队列名称，传输设置，报警规则，以及设备的预设置。

可以操作的选项有四类：
* 传输配置
* 报警规则
* 设备预配置
* 审核日志

创建的时候只有名称是必填的，其余都是非必填项。 每一个设备配置都可以挂载一个规则链，只能从当前可见的规则链库里. 选择一个队列名称，有三种可供选择。

传输配置中只有一个选项可以配置，就是传输方式， 如果选择了默认的传输方式，则可以支持 MQTT, HTTP 和 CoAP 传输

报警规则可以添加多个，配置比较复杂

填写报警类型，严重等级，以及报警规则条件。也可以配置清楚报警规则。

设备预配置有三种策略供选择， 禁止，允许创建新设备，检查预配置的设备。

在设备配置的详情页，有一个审计日志，可以看到一些操作日志。 所有的新增，更新，都会追加一条日志，无法删除。 点击日志的详情可以查看日志的json数据

### 设备

设备管理页面可以根据设备配置来进行筛选。

此外每一个设备都可以设置为是否公开，是否是网关，分配给客户，撤销分配，以及管理凭证，和删除。 其中管理凭证是设备上传数据，与tb通讯的唯一标识。 点击操作栏的 盾牌可以查看设备的凭证。

创建一个设备需要填写的必填内容会比较多， 名称，传输方式，选择设备配置，也可以在此处进行创建设备配置。

点击每一行的设备可以查看设备的详情，可以进行编辑操作。 分别可以查询或操作的数据有
* 详情，基本信息
* 属性
* 最新遥测数据
* 警告
* 事件
* 关联
* 审核日志

### 实体视图

### 部件库

### 仪表板库

### 审核日志

### Api 使用统计

## 参考

ThingsBoard教程（四）：规则链简介与操作_专栏_易百纳技术社区
https://www.ebaina.com/articles/140000005559
