## 系统管理相关模块介绍

介绍系统模块必须要以每一个角色来讲。因为每一个角色登录系统看到的模块都是不一样的。目前系统从上到下，大致有这些角色，系统管理员，租户管理员，租户，用户。 那么首先让我来给大家介绍一下系统管理员登录系统后，所能操作的一些模块。 

### 租户模块

租户是系统管理员下的一级，你可以把一个租户当做一个企业，组织来对待。 因为TB是支持多租户的，所以你搭建一个 TB 系统，可以当做也给 Pass 或 Sass 平台来使用，给 B 端用户开一个租户账号，让其自己管理账户下的资源。这也是 Sass 化中的一个重要功能，多租户。租户之间的资源是隔离起来的。

创建一个租户只需要填写很少的内容，标题和租户简介。

## 租户配置

具体来说可以配置租户的资源有
* 隔离版芯容器内的加工
* 在独立的 ThingsBoard 规则引擎容器中处理

配置设置中有
* 最大设备数（0-不受限制）
* 最大资产数量（0-不受限制）
* 最大客户数（0-不受限制）
* 最大用户数（0-不受限制）
* 仪表板的最大数（0-不受限制）
* 最大规则链数（0-不受限制）
* 最大传输消息（0-不受限制）
* 传输数据点的最大数量（0-不受限制）
* 最大规则引擎执行数（0-不受限制）
* 最大JavaScript执行数（0-不受限制）
* 最大日存储数据点数
* 默认存储TTL天数
* 每条消息的最大规则节点执行数
* 发送的最大电子邮件数
* 发送的最大短信数
* 传输租户消息速率限制
* 租户遥测消息速率限制
* 租户遥测数据点速率限制
* 传输设备消息速率限制
* 设备遥测消息速率限制
* 设备遥测数据点 速率限制

一共 21 个指标，颗粒度可以说是非常的小了，使用租户配置可以很精细地控制租户的资源使用。每一个指标都可以与钱挂钩。 

### 部件库模块 widgets-bundles

这个模块佳作部件库，就像 iPhone 上的部件，这个模块的作用就是将设备的数据，或其他表单，使用组件的方式形式，展示出来。 

首先点右上角的加号，可以点击创建新的部件库。

如果创建成功却没有在列表显示，请检查一下是否是点击的排序。

这样创建部件组之后，只是一个空的部件组，其中是没有部件的，内部的部件需要在部件组创建后再添加。

往部件组中添加部件，部件目前有五种类型:
* Timeseries
* 最新值
* 控件部件
* 警告部件
* 静态部件

不得不说，ThingBoard 项目在交互，通用性，以及简易性都做的非常地好。

> 创建部件需要编写 html，css，js代码，也可以引入其他 js 库，css 库。

### 系统设置模块的使用

**基本设置**
基础设置模块只有二个配置项，即基本 URL，和是否禁止从客户端请求头中使用主机名

**发送邮件**
目前系统中有几处发送邮件的，告警，激活账号，就是一个租户管理员创建了一个客户，让这个客户激活该账号， 可以选择给他发送一封邮件，或者生成一个激活链接给他。 

**SMS 服务商**
SMS 服务上设置其实就是短信平台的设置，目前只支持亚马逊和 Twilio 二个平台。 如果需要国内的 SMS 服务商，可以自己开发。 有关 SMS 的设置，可以[查阅官方的帮助文档](https://thingsboard.io/docs/user-guide/ui/sms-provider-settings)

**安全设置**
安全模块就是为了防止被人暴力破解，和引导用户加强密码请到的配置。

可以配置的项有

* 登录失败之前的最大登录尝试次数
* 如果用户账号锁定，请发送通知到电子邮件
* 最小的密码长度，默认6位
* 最小大写字母数
* 最小小写字母数
* 最小位数
* 最小特殊字符数
* 密码有效期（天）
* 密码重用频率(天)

**OAuth2**

OAuth2 模块是用于配置多系统单点登录。

ThingsBoard 允许你为客户提供单一登录功能，并使用支持 OAuth 2.0 协议的外部用户管理平台自动创建租户，客户或子客户。 支持 OAuth 2.0 协议的平台列表：Google，Okta，Auth0等。

基本的流程是这个样子的。

ThingsBoard 支持授权码授予类型，以交换访问令牌的授权码。 用户通过重定向URL返回 ThingsBoard 客户端后，平台将从URL获取授权代码，并将其用于从外部用户管理平台请求访问令牌。使用基本映射器或自定义映射器，外部用户信息对象将从外部平台转换为 ThingsBoard 内部 OAuth 2.0 用户。此后，将发生常规的 ThingsBoard 授权流程。

官方提供了二种详细的配置 OAuth2 模块的方式，一种是 Google，一种是 OAuth0。
