## 表25 ota_packageota 升级包信息表

| **字段名**         | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明** |
| ------------------ | ------------ | -------- | -------- | -------- | ---------- | -------- | -------- |
| id                 | uuid         |          | Y        | N        | N          | Y        |          |
| created_time       | int8         | 64       | N        | N        | N          | Y        |          |
| tenant_id          | uuid         |          | N        | N        | Y          | Y        |          |
| device_profile_id  | uuid         |          | N        | Y        | N          | N        |          |
| type               | varchar      | 32       | N        | N        | N          | Y        |          |
| title              | varchar      | 255      | N        | N        | N          | Y        |          |
| version            | varchar      | 255      | N        | N        | N          | Y        |          |
| tag                | varchar      | 255      | N        | N        | N          | N        | 版本标签 |
| url                | varchar      | 255      | N        | N        | N          | N        |          |
| file_name          | varchar      | 255      | N        | N        | N          | N        |          |
| content_type       | varchar      | 255      | N        | N        | N          | N        |          |
| checksum_algorithm | varchar      | 32       | N        | N        | N          | N        |          |
| checksum           | varchar      | 1020     | N        | N        | N          | N        |          |
| data               | oid          |          | N        | N        | N          | N        |          |
| data_size          | int8         | 64       | N        | N        | N          | N        |          |
| additional_info    | varchar      |          | N        | N        | N          | N        |          |
| search_text        | varchar      | 255      | N        | N        | N          | N        |          |

## 表26relation关系表

| **字段名**          | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**   |
| ------------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ---------- |
| from_id             | uuid         |          | Y        | N        | N          | Y        | 从实体id   |
| from_type           | varchar      | 255      | N        | N        | N          | Y        | 从实体类型 |
| to_id               | uuid         |          | N        | N        | N          | Y        | 到实体id   |
| to_type             | varchar      | 255      | N        | N        | N          | Y        | 到实体类型 |
| relation_type_group | varchar      | 255      | N        | N        | N          | Y        | 关系组     |
| relation_type       | varchar      | 255      | N        | N        | N          | Y        | 关系类型   |
| additional_info     | varchar      |          | N        | N        | N          | N        | 详细信息   |

## 表27 resource

| **字段名**    | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明** |
| ------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | -------- |
| id            | uuid         |          | Y        | N        | N          | Y        |          |
| created_time  | int8         | 64       | N        | N        | N          | Y        |          |
| tenant_id     | uuid         |          | N        | N        | Y          | Y        |          |
| title         | varchar      | 255      | N        | N        | N          | Y        |          |
| resource_type | varchar      | 32       | N        | N        | N          | Y        |          |
| resource_key  | varchar      | 255      | N        | N        | N          | Y        |          |
| search_text   | varchar      | 255      | N        | N        | N          | N        |          |
| file_name     | varchar      | 255      | N        | N        | N          | Y        |          |
| data          | varchar      |          | N        | N        | N          | N        |          |

## 表28 rpc 表

| **字段名**      | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明** |
| --------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | -------- |
| id              | uuid         |          | Y        | N        | N          | Y        |          |
| created_time    | int8         | 64       | N        | N        | N          | Y        |          |
| tenant_id       | uuid         |          | N        | N        | N          | Y        |          |
| device_id       | uuid         |          | N        | N        | N          | Y        |          |
| expiration_time | int8         | 64       | N        | N        | N          | Y        |          |
| request         | varchar      | 10000000 | N        | N        | N          | Y        |          |
| response        | varchar      | 10000000 | N        | N        | N          | N        |          |
| additional_info | varchar      | 10000000 | N        | N        | N          | N        |          |
| status          | varchar      | 255      | N        | N        | N          | Y        |          |

## 表 29 rule_chain 规则链表

| **字段名**         | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**             |
| ------------------ | ------------ | -------- | -------- | -------- | ---------- | -------- | -------------------- |
| id                 | uuid         |          | Y        | N        | N          | Y        | 设备编号             |
| created_time       | int8         | 64       | N        | N        | N          | Y        | 创建时间             |
| additional_info    | varchar      |          | N        | N        | N          | N        | 额外信息             |
| configuration      | varchar      | 10000000 | N        | N        | N          | N        | 配置                 |
| name               | varchar      | 255      | N        | N        | N          | N        | 名称                 |
| type               | varchar      | 255      | N        | N        | N          | N        | 目前取值有CORE、EDGE |
| first_rule_node_id | uuid         |          | N        | N        | N          | N        | 第一规则节点编号     |
| root               | bool         |          | N        | N        | N          | N        | 是否根节点           |
| debug_mode         | bool         |          | N        | N        | N          | N        | 是否debug模式        |
| search_text        | varchar      | 255      | N        | N        | N          | N        | 搜素关键字           |
| tenant_id          | uuid         |          | N        | N        | N          | N        | 租户编号             |

## 表 30 rule_node 规则节点表

| **字段名**      | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**                 |
| --------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ------------------------ |
| id              | uuid         |          | Y        | N        | N          | Y        | 设备编号                 |
| created_time    | int8         | 64       | N        | N        | N          | Y        | 创建时间                 |
| rule_chain_id   | uuid         |          | N        | N        | N          | N        | 规则引擎编号             |
| additional_info | varchar      |          | N        | N        | N          | N        | 额外信息                 |
| configuration   | varchar      | 10000000 | N        | N        | N          | N        | 配置                     |
| type            | varchar      | 255      | N        | N        | N          | N        | 类型，具体内容为Java包名 |
| name            | varchar      | 255      | N        | N        | N          | N        | 名称                     |
| debug_mode      | bool         |          | N        | N        | N          | N        | 是否debug模式            |
| search_text     | varchar      | 255      | N        | N        | N          | N        | 搜素关键字               |

## 表31 rule_node_state规则节点状态表

| **字段名**   | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**                  |
| ------------ | ------------ | -------- | -------- | -------- | ---------- | -------- | ------------------------- |
| id           | uuid         |          | Y        | N        | N          | Y        | 编号                      |
| created_time | int8         | 64       | N        | N        | N          | Y        | 创建时间                  |
| rule_node_id | uuid         |          | N        | Y        | Y          | Y        | 外键关联rule_node的id主键 |
| entity_type  | varchar      | 32       | N        | N        | N          | Y        |                           |
| entity_id    | uuid         |          | N        | N        | N          | Y        |                           |
| state_data   | varchar      | 16384    | N        | N        | N          | Y        |                           |

## 表32 tb_schema_settings 数据模式设置

| **字段名**     | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**     |
| -------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ------------ |
| schema_version | int8         | 64       | Y        | N        | N          | Y        | 数据模式版本 |

## 表33tb_user用户表

| **字段名**      | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**                                                |
| --------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ------------------------------------------------------- |
| id              | uuid         |          | Y        | N        | N          | Y        | 用户编号                                                |
| created_time    | int8         | 64       | N        | N        | N          | Y        | 创建时间                                                |
| additional_info | varchar      |          | N        | N        | N          | N        | 额外信息                                                |
| authority       | varchar      | 255      | N        | N        | N          | N        | 权限，目前角色有 SYS_ADMIN，TENANT_ADMIN，CUSTOMER_USER |
| customer_id     | uuid         |          | N        | N        | N          | N        | 客户编号                                                |
| email           | varchar      | 255      | N        | N        | Y          | N        | 邮箱                                                    |
| first_name      | varchar      | 255      | N        | N        | N          | N        | 姓                                                      |
| last_name       | varchar      | 255      | N        | N        | N          | N        | 名                                                      |
| search_text     | varchar      | 255      | N        | N        | N          | N        | 搜索关键字                                              |
| tenant_id       | uuid         |          | N        | N        | N          | N        | 租户编号                                                |

## 表34 tenant 租户表

| **字段名**        | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**                         |
| ----------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | -------------------------------- |
| id                | uuid         |          | Y        | N        | N          | Y        | 租户唯一编号                     |
| created_time      | int8         | 64       | N        | N        | N          | Y        | 创建时间戳                       |
| additional_info   | varchar      |          | N        | N        | N          | N        | 额外信息                         |
| tenant_profile_id | uuid         |          | N        | Y        | N          | Y        | 外键，关联tenant_profile的id字段 |
| address           | varchar      |          | N        | N        | N          | N        | 第一地址                         |
| address2          | varchar      |          | N        | N        | N          | N        | 第二地址                         |
| city              | varchar      | 255      | N        | N        | N          | N        | 城市                             |
| country           | varchar      | 255      | N        | N        | N          | N        | 国家                             |
| email             | varchar      | 255      | N        | N        | N          | N        | 邮箱                             |
| phone             | varchar      | 255      | N        | N        | N          | N        | 电话号码                         |
| region            | varchar      | 255      | N        | N        | N          | N        | 区域                             |
| search_text       | varchar      | 255      | N        | N        | N          | N        | 搜索关键字                       |
| state             | varchar      | 255      | N        | N        | N          | N        | 省份                             |
| title             | varchar      | 255      | N        | N        | N          | N        | 租户名称                         |
| zip               | varchar      | 255      | N        | N        | N          | N        | 邮政编码                         |

## 表 35 tenant_profile 租户配置

| **字段名**              | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**               |
| ----------------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ---------------------- |
| id                      | uuid         |          | Y        | N        | N          | Y        | 租户配置唯一编号       |
| created_time            | int8         | 64       | N        | N        | N          | Y        | 创建时间戳             |
| name                    | varchar      | 255      | N        | N        | Y          | N        | 名称                   |
| profile_data            | jsonb        |          | N        | N        | N          | N        | 详情数据json           |
| description             | varchar      |          | N        | N        | N          | N        | 说明                   |
| search_text             | varchar      | 255      | N        | N        | N          | N        | 搜索关键字             |
| is_default              | bool         |          | N        | N        | N          | N        | 是否是默认选项         |
| isolated_tb_core        | bool         |          | N        | N        | N          | N        | 是否单独tb容器服务     |
| isolated_tb_rule_engine | bool         |          | N        | N        | N          | N        | 是否单独 tb 规则引擎服务 |

## 表 36 ts_kv_indefinite 表

| **字段名** | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**           |
| ---------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ------------------ |
| entity_id  | uuid         |          | Y        | N        | N          | Y        | 实体id             |
| key        | int4         | 32       | N        | N        | N          | Y        | 属性标识           |
| ts         | int8         | 64       | N        | N        | N          | Y        | 时间               |
| bool_v     | bool         |          | N        | N        | N          | N        | 存放属性的布尔值   |
| str_v      | varchar      | 10000000 | N        | N        | N          | N        | 存放属性的字符串值 |
| long_v     | int8         | 64       | N        | N        | N          | N        | 存放属性的数字值   |
| dbl_v      | float8       | 53       | N        | N        | N          | N        | 存放属性的小数值   |
| json_v     | json         |          | N        | N        | N          | N        |                    |

## 表37 ts_kv_dictionary 字典表

| **字段名** | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明** |
| ---------- | ------------ | -------- | -------- | -------- | ---------- | -------- | -------- |
| key        | varchar      | 255      | Y        | N        | N          | Y        |          |
| key_id     | int4         | 32       | N        | N        | Y          | Y        |          |

## 表 38 ts_kv_latest 

| **字段名** | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**           |
| ---------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ------------------ |
| entity_id  | uuid         |          | Y        | N        | N          | Y        | Id                 |
| key        | int4         | 32       | N        | N        | N          | Y        | 属性标识           |
| ts         | int8         | 64       | N        | N        | N          | Y        | 时间               |
| bool_v     | bool         |          | N        | N        | N          | N        | 存放属性的布尔值   |
| str_v      | varchar      | 10000000 | N        | N        | N          | N        | 存放属性的字符串值 |
| long_v     | int8         | 64       | N        | N        | N          | N        | 存放属性的数字值   |
| dbl_v      | float8       | 53       | N        | N        | N          | N        | 存放属性的小数值   |
| json_v     | json         |          | N        | N        | N          | N        |                    |

## 表 39 user_credentials 用户凭证表

| **字段名**     | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**     |
| -------------- | ------------ | -------- | -------- | -------- | ---------- | -------- | ------------ |
| id             | uuid         |          | Y        | N        | N          | Y        | 用户认证编号 |
| created_time   | int8         | 64       | N        | N        | N          | Y        | 创建时间     |
| activate_token | varchar      | 255      | N        | N        | Y          | N        | 激活令牌     |
| enabled        | bool         |          | N        | N        | N          | N        | 是否开启     |
| password       | varchar      | 255      | N        | N        | N          | N        | 加密后密码   |
| reset_token    | varchar      | 255      | N        | N        | Y          | N        | 重置令牌     |
| user_id        | uuid         |          | N        | N        | Y          | N        | 用户编号     |

## 表 40 widget_type 部件类型表

| **字段名**   | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**       |
| ------------ | ------------ | -------- | -------- | -------- | ---------- | -------- | -------------- |
| id           | uuid         |          | Y        | N        | N          | Y        | 编号           |
| created_time | int8         | 64       | N        | N        | N          | Y        | 创建时间       |
| alias        | varchar      | 255      | N        | N        | N          | N        | 别名           |
| bundle_alias | varchar      | 255      | N        | N        | N          | N        | 所属部件包     |
| descriptor   | varchar      | 1000000  | N        | N        | N          | N        | 描述json       |
| name         | varchar      | 255      | N        | N        | N          | N        | 名称           |
| tenant_id    | uuid         |          | N        | N        | N          | N        | 租户编号       |
| image        | varchar      | 1000000  | N        | N        | N          | N        | 图片base64编码 |
| description  | varchar      | 255      | N        | N        | N          | N        | 描述           |

## 表 41 widgets_bundle 部件包

| **字段名**   | **字段类型** | **长度** | **主键** | **外键** | **唯一键** | **非空** | **说明**       |
| ------------ | ------------ | -------- | -------- | -------- | ---------- | -------- | -------------- |
| id           | uuid         |          | Y        | N        | N          | Y        | 编号           |
| created_time | int8         | 64       | N        | N        | N          | Y        | 创建时间       |
| alias        | varchar      | 255      | N        | N        | N          | N        | 别名           |
| search_text  | varchar      | 255      | N        | N        | N          | N        | 搜索关键字     |
| tenant_id    | uuid         |          | N        | N        | N          | N        | 租户编号       |
| title        | varchar      | 255      | N        | N        | N          | N        | 名称           |
| image        | varchar      | 1000000  | N        | N        | N          | N        | 图片base64编码 |
| description  | varchar      | 255      | N        | N        | N          | N        | 描述           |
