文章内容为 AI 绘画相关，必须使用并提到高性能应用服务HAI，选题方向包括：


# 【腾讯云 HAI】基于 StableDiffusion 的 WebUI 绘画部署实战

## 背景介绍

腾讯云高性能应用服务 HAI 是为开发者量身打造的澎湃算力平台。无需复杂配置，便可享受即开即用的GPU云服务体验。在 HAI 中，根据应用智能匹配并推选出最适合的GPU算力资源，以确保您在数据科学、LLM、AI作画等高性能应用中获得最佳性价比。

HAI 服务优势
智能选型 ：根据应用匹配推选GPU算力资源，实现最高性价比。同时，打通必备云服务组件，大幅简化云服务配置流程。

一键部署 ：分钟级自动构建LLM、AI作画等应用环境。提供多种预装模型环境，包含如StableDiffusion、ChatGLM等热门模型。

可视化界面 ：友好的图形界面，AI调试更为简单

场景介绍
基于HAI部署的StableDiffusionWebUI快速进行AI绘画




在实例列表中选择算力连接 > Gradio WebUI 并进入该实例的详情页。

接下来我们使用 Stable Diffusion WebUI 生成一张猫咪图片，配置以下参数后，单击 Generate 即可。


步骤1：创建高性能应用服务

[进入高性能应用服务购买页面](https://buy.cloud.tencent.com/hai)

等待应用创建成功

您可以在此页面查看 Stable Diffusion 详细的配置信息。


## 步骤2：启动 HAI 实例进行文生图模型推理


在实例列表中选择算力连接 > Gradio WebUI 并进入该实例的详情页。

使用高性能应用服务 HAI 部署的 Stable Diffusion WebUI 快速进行 AI 绘画。

提示词（Prompt）越多，AI 绘图结果会更加精准。另外，目前中文提示词的效果不好，还得使用英文提示词。


接下来我们使用 Stable Diffusion WebUI 生成一张猫咪图片，配置以下参数后，单击 Generate 即可。


| 参数名          | 描述                                                         | 值                                                           |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Prompt          | 主要描述图像，包括内容风格等信息，原始的 WebUI会对此处有字数的限制，您可以通过安装一些插件来突破字数的限制。 | a pretty cat,cyberpunk art，kerem beyit，very cute  robot zen,Playful,Independent，beeple |
| Negative prompt | 为了提供给模型，您不需要的风格。                             | (deformed，distorted，disfigured:1.0)，poorly drawn，bad anatomy，wrong anatomy，extra limb，missing limb，floating limbs，(mutated hands  and fingers:1.5)，disconnected limbs，mutation，mutated，ugly，disgusting，blurry，amputation，flowers，human，man，woman |
| CFG scale       | 分类器自由引导尺度，图像与提示符的一致程度。越低的值产生的结果越有创意，数值越大成图越贴近描述文本。一般设置为7。 | 7                                                            |
| Sampling method | 扩散算法的去噪声采样模式会影响最终效果，不同的采样模式的结果会有很大差异，一般是默认选择 euler。 | Euler a                                                      |
| Sampling steps  | 在使用扩散模型生成图片时所进行的迭代步骤。需要注意的是，更高的迭代步数会消耗更多的计算时间和成本，但并不意味着一定会得到更好的结果。 | 80                                                           |
| Seed            | 随机数种子，生成每张图片时的随机种子。                       | 1791574510                                                   |


我们稍加配置即可生成所需图片。



赛博朋克风

提示词: Cyberpunk, 8k resolution, castle, the rose sea, dream


水墨画风格

提示词: a watercolor ink painting of a fallen angel with a broken halo wielding a jagged broken blade standing on top of a skyscraper in the style of anti - art trending on artstation deviantart pinterest detailed realistic hd 8 k high resolution









cd stable-diffusion-webui
python launch.py --nowebui --xformers --opt-split-attention  --listen --port 7898



http://134.175.64.13:7898/docs


/sdapi/v1/txt2img文字生图 POST
/sdapi/v1/img2img图片生图 POST
/sdapi/v1/options获取设置 GET | 更新设置 POST（可用来更新远端的模型）
/sdapi/v1/sd-models获取所有的模型 GET


| 名称            | 说明         |
| --------------- | ------------ |
| prompt          | 提示词       |
| negative_prompt | 反向提示词   |
| seed            | 种子，随机数 |
| batch_size      | 每次张数     |
| n_iter          | 生成批次     |
| steps           | 生成步数     |
| cfg_scale       | 关键词相关性 |
| width           | 宽度         |
| height          | 高度         |
| restore_faces   | 脸部修复     |
| tiling          | 可平铺       |
| sampler_index   | 采样方法     |


{
     "denoising_strength": 0,
     "prompt": "puppy dogs",
     "negative_prompt": "",
     "seed": -1,
     "batch_size": 2,
     "n_iter": 1,
     "steps": 50,
     "cfg_scale": 7,
     "width": 512,
     "height": 512,
     "restore_faces": false,
     "tiling": false,
     "sampler_index": "Euler" 
}


请求 API 接口成功截图如下：


返回的格式如下：

{
   "images": [...]，// 这里是一个base64格式的字符串数组，根据请求的图片数量而定
   "parameters": {  ... },//此处为输入的body 
   "info": "{...}"// 返回的图片的信息
}

当看到类似上图的消息时，说明已经成功与远端的服务器进行连接！如果希望验证结果的图片的实际展示效果，可以复制 images 中的其中一张图片的 base64 格式的字符串，到相关的网站下转换为 jpg 格式。



使用 Python 向高性能应用服务 HAI 提供的 StableDiffusionAPI 发送请求。
以下演示如何使用 Python 向 StableDiffusion API 发出请求。向应用程序的 txt2img（即文本到图像）API 发送 POST 请求以简单地生成图像。
我们将使用 requests 包，如果您还没有安装，请使用安装脚本：

pip install requests 


```py
import json
import base64
import requests
 
your_ip = '0.0.0.0' # HAI服务器IP地址
your_port =7862  # SD api 监听的端口
 
def submit_post(url: str,data: dict):
  """
  Submit a POST request to the given URL withthe given data.
  """
  return requests.post(url,data=json.dumps(data))
 
def save_encoded_image(b64_image: str,output_path: str):
  """
  Save the given image to the given outputpath.
  """
  with open(output_path,"wb") asimage_file:
      image_file.write(base64.b64decode(b64_image))
 
if __name__ == '__main__':
  #/sdapi/v1/txt2img
  txt2img_url = f'http://{your_ip}:{your_port}/sdapi/v1/txt2img'
  data = {
     'prompt': 'a pretty cat,cyberpunk art,kerem beyit,verycute robot zen,Playful,Independent,beeple |',
     'negative_prompt':'(deformed,distorted,disfigured:1.0),poorlydrawn,bad anatomy,wrong anatomy,extra limb,missing limb,floating limbs,(mutatedhands and fingers:1.5),disconnectedlimbs,mutation,mutated,ugly,disgusting,blurry,amputation,flowers,human,man,woman',
     'Steps':50,
     'Seed':1791574510
  }
  response = submit_post(txt2img_url,data)
  save_encoded_image(response.json()['images'][0],'cat.png')
```

请记住，您的结果会与上述示例有所不同。 如果遇到问题，请仔细检查运行 StableDiffusionAPI 应用程序的终端的输出。 如果您遇到404 Not Found 的问题，请仔细检查 URL 是否输入正确并指向正确的地址（例如 127.0.0.1）。


AI数字绘画 stable-diffusion 保姆级教程 - 知乎

https://zhuanlan.zhihu.com/p/560226367