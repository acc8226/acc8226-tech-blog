---
title: zabbix 简单使用
date: 2022-12-09 15:20:00
updated: 2022-12-09 15:20:00
categories:
  - 应用
  - 运维监控
tags: 运维监控
---

## 登录和配置用户

Zabbix 内创建一个系统用户。

### 登录

这是 Zabbix 的“欢迎”界面。输入用户名 **Admin** 以及密码 **zabbix** 以作为 [Zabbix超级用户](https://www.zabbix.com/documentation/6.0/zh/manual/config/users_and_usergroups/permissions)登录。将授予访问*配置*和*管理*菜单的权限。

### 创建用户

可以在*管理（Administration） → 用户（Users）*下查看用户信息。

点击 *创建用户*添加一个新用户。

<!-- more -->

在创建的用户表单中，请确保将你的用户添加到现有的 [用户组](https://www.zabbix.com/documentation/6.0/zh/manual/config/users_and_usergroups/usergroup), 例如 'Zabbix administrators'。

我这里用户名填入 user，密码填入 zabbixpwd。注意所有必填输入字段均标有红色星号。

默认情况下，新用户没有为其定义媒介（通知传递方法）。如果要创建，请转到“媒介”选项卡并单击*添加*。

在此弹出窗口中，输入用户的电子邮件地址。

你可以为媒介指定一个时间活动周期 (参考 [时间周期说明](https://www.zabbix.com/documentation/6.0/zh/manual/appendix/time_period) 页面，查看该字段格式的描述），默认情况下，媒介一直是活动的。你也可以通过自定义[触发器严重等级](https://www.zabbix.com/documentation/6.0/zh/manual/config/triggers/severity)来激活媒介，但暂时保持所有级别的都处于启用状态。

点击*添加*保存媒介，然后转到“权限”选项卡。

权限选项卡有一个必填字段*角色*。该角色决定用户可以查看哪些前端元素，以及允许用户执行哪些操作。点击选择，然后从列表中选择一个角色。例如，选择*Admin role*以允许访问除管理之外的所有Zabbix前端部分。稍后，你可以修改权限或创建更多用户角色。选择角色后，权限将显示在同一选项卡中：

在用户窗口中点击*添加*以保存用户。新用户将出现在用户列表中。

### 添加权限

默认情况下，一个新的用户没有权限访问主机。要授予用户权限，请单击*组*列中的用户组（在本例中为“Zabbix administrators”）。在“用户群组”窗口中，转到“权限”选项卡。

该用户需要以只读方式访问*Linux Server*主机组，因此请单击用户组选择字段旁边的*选择*。

在此弹出框中，选中在“Linux servers”旁边的复选框，然后单击*选择*。*Linux servers*就会显示在选择清单中。 单击“Read”按钮设置权限级别，然后添加到权限列表中。 在用户组属性表单中，单点击*更新*。

在Zabbix中，主机的访问权限被分配给 [用户组](https://www.zabbix.com/documentation/6.0/zh/manual/config/users_and_usergroups/usergroup), 而不是单独的用户。

权限设置完成了！ 您可以尝试使用新用户的凭据登录。

## 新建主机

Zabbix中的主机是一个你想要监控的网络实体（物理的，或者虚拟的）。Zabbix 中，对于主机的定义非常灵活。它可以是一台物理服务器，一个网络交换机，一个虚拟机或者某些应用程序。

### 添加主机

Zabbix中，可以通过*配置 → 主机*或者*监测* → *主机*，查看已配置的主机信息。默认已有一个名为'Zabbix server'的预先定义好的主机。但我们需要学习如何添加另一个。

点击*创建主机*来新增一台主机。将会展示出一个主机配置表。

所有必填字段均标有红色星号。

至少需要提供以下信息：

***主机名***

- 输入一个主机名。允许使用大小写字母、数字、空格、点、破折号和下划线。

***主机组***

- 通过单击*选择*按钮选择一个或多个现有组，或输入不存在的主机组名以创建新组。

注意：所有访问权限都是分配给主机组的，而不是单个主机。这就是为什么一个主机必须至少属于一个主机组。

***接口: IP地址***

- 虽然技术上它不是必填字段，但您可能希望输入主机的IP地址。请注意，如果这是Zabbix server的IP地址，必须在Zabbix agent配置文件中指定'Server'参数值。

[其他选项](https://www.zabbix.com/documentation/6.0/zh/manual/config/hosts/host#configuration) 我们暂时使用默认值。

当完成后，点击*添加*。你可以在主机列表中看到你新添加的主机。

可用性列包含每个接口的主机可用性指标。 我们已经定义了Zabbix代理接口，因此我们可以使用代理可用性图标(上面有‘ZBX’)来判断主机可用性
。

## 新增监控项

监控项是 Zabbix 中采集数据的基础。没有监控项，就没有数据——因为一个主机中只有监控项定义了单一的指标或者需要获得的数据。

### 添加监控项

所有的监控项都是依赖于主机的。这就是为什么我们要配置一个监控项时，先要进入*配置 → 主机*页面查找到新建的主机。

在"新主机"行中，点击*监控项*这个链接，然后点击*创建监控项*，将会展示一个监控项配置表。

所有必填字段均标有红色星号。

对于我们的示例，需要提供以下信息:

***名称***

- 输入*CPU load* 作为值. 在列表和其他地方，都会显示这个值作为监控项名称。

***键值***

- 手动输入 system.cpu.load 作为值。 这是监控项的一个技术上的名称，用于识别获取信息的类型。这个特定值需要是Zabbix agent[预定义键值](https://www.zabbix.com/documentation/6.0/zh/manual/config/items/itemtypes/zabbix_agent)的其中一种。

***信息类型***

- 此属性定义预期数据的格式。对于键值 *system.cpu.load* , 这个字段会自动设置成 *浮点数*.

您可能还希望减少[监控项历史数据](https://www.zabbix.com/documentation/6.0/zh/manual/config/items/history_and_trends)的保留天数为7天或14天。这是一种很好的做法，可以避免数据库保存大量的历史数据。

[其他选项](https://www.zabbix.com/documentation/6.0/zh/manual/config/items/item#configuration) 我们暂时使用默认值。

当完成后，点击*添加*。新的监控项将出现在监控项列表中。点击列表中的详细以查看具体细节。

### 查看数据

当一个监控项创建完成后，你可能好奇它具体获得了什么值。前往*Monitoring → Latest data*， 在过滤器中选择刚才新建的主机，然后点击*Apply*。

同时，第一次获得的监控项值最多可能需要60秒。默认情况下，这是服务器读取变化后的配置文件，获取并执行新的监控项的频率。

如果你在”更改“列中没有看到值，可能到目前为止只获得了一次值。等待30秒以获得新的监控项值。

如果你在没有看到类似截图中的监控项信息，请确认：

- 你输入的监控项”键值“和”信息类型“同截图中的一致
- agent和server都处于运行状态
- 主机状态为“已启用”并且它的可用性图标是绿色的
- 在主机的下拉菜单中已经选择了对应主机，且监控项处于已启用状态

#### 图表

当监控项运行了一段时间后，可以查看可视化图表。 [简单图表](https://www.zabbix.com/documentation/6.0/zh/manual/config/visualization/graphs/simple) 适用于任何信息类型为数值型的监控项，且不需要额外的配置。这些图表会在运行时生成。

前往*Monitoring → Latest data*，然后点击监控项后的”图表“'链接来查看。

## 新建触发器

监控项只是用于收集数据. 如果需要自动评估收到的数据，我们需要定义触发器。触发器包含了一个表达式，这个表达式定义了数据的可接受的阈值级别。

如果收到的数据超过了这个定义好的级别，触发器将被“触发”，或者进入“问题”状态——从而引起我们的注意，让我们知道有问题发生。如果数据再次恢复到合理的范围，触发器将返回“ok”状态。

### 添加触发器

为监控项配置触发器，前往*配置 → 主机*，找到”新增的主机“，点击旁边的*触发器* ，然后点击*创建触发器*。将会展示一个触发器配置表。 

对于我们的触发器，需要提供以下信息：

*名称*

- 输入*CPU load too high on 'New host' for 3 minutes* 作为值。 在列表和其他地方，都会显示这个值作为触发器名称。

*表达式*

- 输入: avg(/New host/system.cpu.load,3m)>2

这个是触发器的表达式。确认这个表达式输入正确，直到最后一个符号。这个监控项键值(system.cpu.load)用于指出具体的监控项。这个特定的表达式大致是说如果3分钟内，CPU负载的平均值超过2，那么就触发了问题的阈值。你可以查看更多的 [触发器表达式语法](https://www.zabbix.com/documentation/6.0/zh/manual/config/triggers/expression)。

完成后，点击*添加*。新的触发器将会显示在触发器列表中。

### 显示触发器状态

当一个触发器定义后，你可能想查看它的状态。

如果CPU负载超过了你在触发器中定义的阈值，这个问题将显示在*监测 → 问题*中。

状态栏中的闪烁表示最近触发状态的变化，即过去30分钟内发生的变化。

## 接收问题通知

当监控项收集数据并且触发器处于问题的状态下，在系统中设定告警机制也很有用，这将使我们不需要盯着Zabbix前端也能收到一些重要的事件通知。

这就是通知的功能。电子邮件是最受欢迎的问题通知方式，我们将会学习如何设置电子邮件通知。

### 电子邮件设置

Zabbix中最开始预定义了一些通知[发送方式](https://www.zabbix.com/documentation/6.0/zh/manual/config/notifications/media)。 [电子邮件](https://www.zabbix.com/documentation/6.0/zh/manual/config/notifications/media/email)是其中的一种。

前往*管理 → 媒介类型*，点击预定义媒介类型列表中的*Email*，以配置电子邮件。

这将为我们展示电子邮件设置定义表单。

所有必填字段均标有红色星号。

根据你的环境，设置SMTP服务器，SMTP HELO以及SMTP电子邮件的值。

”SMTP电子邮件“ 将作为Zabbix通知的“发件人”地址。

一切就绪后，点击*更新*。

现在你已经配置了”电子邮件“作为一种可用的媒介类型。一个媒介类型必须通过发送地址来关联用户(如同我们在[配置一个新用户](https://www.zabbix.com/documentation/6.0/zh/manual/quickstart/login#adding-user))中做的，否则它将无法生效。

### 新建动作

发送通知是Zabbix中[动作](https://www.zabbix.com/documentation/6.0/zh/manual/config/notifications/action)执行的操作之一。因此，为了建立一个通知，前往*配置 → 动作*，然后点击*创建动作*。

所有必填字段均标有红色星号。

在这个表单中，为动作输入一个名称。

在最简单的情况下，如果我们不添加任何更具体的[条件](https://www.zabbix.com/documentation/6.0/zh/manual/config/notifications/action/conditions)，动作 将在从“Ok”到“Problem”的任何触发器状态更改时被执行。

我们还需要定义这个动作具体要做什么 —— 即在 *操作*标签页中执行的操作。点击操作块中的*添加*，将会打开一个操作表单。

所有必填字段均标有红色星号。

这里，在*Send to users*块中点击*添加*并选择我们之前定义的用户('user')。在*仅送到*中选择*Email*。在完成后，点击*添加*，这个操作将会被添加：

这就是一个简单的动作配置，最后点击动作表单中的*添加*。

### 接收通知

现在，在配置了发送通知的情况下，实际接收一个通知会很有趣。为了实现这个目的，我们可能会故意增加主机上的负载——这样我们的 [触发器](https://www.zabbix.com/documentation/6.0/zh/manual/quickstart/trigger#adding-trigger)才会被触发，然后我们会收到问题通知。

打开主机的控制台，并运行：

```sh
cat /dev/urandom | md5sum
```

你可能需要运行一个或者多个 [这样的进程](http://en.wikipedia.org/wiki/Md5sum).

现在，前往*监测 → 最新数据*，查看“CPU Load”的值是否已经增长。记住，为了使我们的触发器被触发，“CPU Load”的值需要在在3分钟运行的过程中超过2。一旦满足这个条件：

- 在*监测 → 问题*中，你可以看到闪烁“问题”状态的触发器。
- 你的电子邮件中，会收到一个问题通知。

如果通知功能没有正常工作：

- 再次验证电子邮件设置和动作设置已经被正确配置
- 确认你创建的用户对生成事件的主机至少拥有读权限。正如*[添加用户](https://www.zabbix.com/documentation/6.0/zh/manual/quickstart/login#adding-user)* 步骤中提到的。“Zabbix 管理员”用户组中的用户必须对'Linux servers'主机组（该主机所属组）至少拥有读权限。
- 另外，你可以在*报表 → 动作日志*中检查动作日志。

## 新建模板

之前我们学习了如何创建监控项、触发器以及如何获取主机的问题通知。

虽然这些步骤提供了很大的灵活性，但仍然需要很多步骤才能完成。如果我们需要配置上千台主机，一些自动化操作会带来更多便利性。

模版功能可以实现这一点。模版允许对有用的监控项、触发器和其他对象进行分组，只需要一步就可以对监控主机应用模版，以达到重复使用的目的。

当一个模版链接到一个主机后，主机会继承这个模版中的所有对象。简单而言，一组预先定义好的检查会被快速应用到主机上。

### 添加模板

在开始使用模版之前，你必须先创建一个。在*配置 → 模版*中，点击*创建模版*。将会展示出一个模版配置表。

所有必填字段均标有红色星号。

此处需要输入的参数包括：

***模板名称***

- 输入一个模板名称。允许使用大小写字母、数字、空格和下划线。

***主机组***

- 通过单击*选择*按钮选择一个或多个现有组。模板必须属于某个主机组。

完成后，点击*添加*。你可以在模板列表中看到你新添加的模板。

你可以在这看到模版信息，但里面什么都没有——没有监控项、触发器或其他其他对象。

### 在模版中添加监控项

在模版中添加监控项，前往“新建主机“的监控项列表。在*配置 → 主机*，点击“新建主机“旁边的*监控项*。

然后：

- 选中列表中“CPU 负载”监控项的选择框
- 点击列表下方的*复制*
- 选择要复制这个监控项的目标模版

所有必填字段均标有红色星号。

- 点击*复制*

你现在可以前往*配置 → 模版*，"新模板"模版中会有一个新的监控项。

我们目前只创建了一个监控项，但你可以用同样的方法在模版中添加其他的监控项，触发器以及其他对象，直到满足特定需求（如监控操作系统，监控单个应用）的完整的对象组合。

### 链接模版到主机

准备好一个模版后，将它链接到一个主机。前往*配置→ 主机*，点击“新建主机”打开其属性表单，并找到**模板**字段。

开始在*模板*字段中键入*新建模板*。我们创建的模板名称应该出现在下拉列表中。向下滚动选择。查看它是否出现在*模板*字段中。

单击表单中的*更新*保存更改。现在，模板和它所持有的所有对象都被添加到主机中。

正如您可能已经猜到的，这种方法也可以应用于任何其他主机。在模板级别对监控项、触发器和其他对象的任何更改都将传播到模板链接到的主机。

#### 链接预定义模版到主机

正如你可能已经注意到的，Zabbix为各种操作系统、设备和应用程序提供了一组预定义的模板。要快速开始监控，您可以将适当的模板链接到主机，但要注意，这些模板需要根据您的环境进行微调。一些检查可能不需要，轮询间隔可能过于频繁。

可参考该链接，查看更多关于[模板](https://www.zabbix.com/documentation/6.0/zh/manual/config/templates)的信息。
