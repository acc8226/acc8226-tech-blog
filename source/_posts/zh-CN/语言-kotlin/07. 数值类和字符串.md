---
title: 07. 数值类和字符串
date: 2023-01-06 23:22:00
updated: 2023-01-06 23:22:00
categories:
  - 语言
  - Kotlin
tags:
- kotlin
---

## 数值类

和 Java 一样，Kotlin 中的所有数字类型都是有符号的（signed），也就是说，它们既可以表示 正数，也可以表示负数。 除了是否支持小数外，数字类型还有个区别是在内存中所占的位数（直接的结果就是它们所能支持的最大值和最小值）。

这里有必要提一下 Short 和 Byte 这两个类型。千言万语汇成一句话，你几乎不会用它们来表示常见的数。它们主要用于和 Java 遗留代码互操作这样的场景。例如，从文件读取数据流 或处理图像时（1 个颜色像素常以 3 字节表示，对应 RGB 三色），你可能就需要和 Byte 打交道。 而需要和不支持 32 位指令的 CPU 原生代码交互时，你很可能会看到 Short 的身影。不管怎么说，大多数情况下，表示整数都用 Int，如果需要更大的数，那么就用 Long。

### 整数和小数

整数是不带小数位的数字，在 Kotlin 中常用 Int 类型表示。带小数位的数字要以 Float 或 Double 类型表示。

### 字符串转数值类型

Kotlin 提供了有用的函数，可以把字符串转换为包括数在内的其他类型值。以下 是最常用的一些转换函数：

 toFloat  toDouble  toDoubleOrNull  toIntOrNull  toLong  toBigDecimal

尝试转换格式错误的字符串会抛出异常。例如，调用 toInt 函数转换字符串“5.91”就会抛出异常，因为字符串的 .91 部分无法转成 Int 值。

考虑到这个问题，Kotlin 提供了 toDoubleOrNull 和 toIntOrNull 这样的安全转换函数。 如果数值不能正确转换，与其触发异常不如干脆返回 null 值。另外，调用 toIntOrNull 函数时， 可以同时使用空合并操作符。例如，你可以提供一个默认值：

```kt
val gold: Int = "5.91".toIntOrNull() ?: 0
```

### Int 类型转 Double 类型

同 Java。当运算的两个数都是整数类型，所以 Kotlin 执行了整数运算，自然也就不会得出小数结果。如果你需要 Kotlin 执行浮点数运算，这就需要参与运算的数中至少有一个带小数位

### Double 类型格式化

要格式化的值作为值参传给 format 函数。Kotlin 使用的格式化字符串和 Java、C/C++、Ruby 等其他语言中的标准格式化字符串是一 样的。想了解更多格式化字符串形式和规则，参见 Java API 文档：<https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html>。

```kt
val d = 1.234567
// 正常输出
println("$d")

val s = "%.2f".format(d)
// 格式化输出
println(s)

// 也可以写在一起
println("s = ${"%.2f".format(d)}")
```

### Double 类型转换为 Int 类型

```kt
println(123.5353.toInt())

// 四舍五入到整数
println(123.5353.roundToInt())
```

### 位运算

Kotlin 提供了一系列函数用于二进制数的运算，这种运算又称为位运算。如果熟悉 Java 语言， 那你应该见过它们。

注：这里用了中缀的写法。

```kt
// 整数转二进制
println(Integer.toBinaryString(42))
// 按位左移
println(1 shl 2)
// 按位右移
println(16 shr 3)
// 取反
println(42.inv())
// 按位异或预算
println(3 xor 5)
// 按位或运算
println(10 or 42)
// 按位与运算
println(10 and 42)
```

## 字符串

### 转义字符和 Unicode 字符编码系统

用\转义字符。是字符还是有特别意义的标记，编译器通过转义字符 就能区分开来了。

举例

```kt
val cc = '\''
```

每个字符都是 Char 类型的一个实例。更具 体地讲，Char 就是 Unicode 字符。按照 Unicode 标准联盟的定义，Unicode 字符编码系统的设计 目的是实现“多种语言书面文字的互相转换、处理和显示”。

要声明一个字符，有两种方式。不过无论采用哪种方式，字符都要放在一对单引号里。

对于 键盘上的字符，最简单的方式就是把它放在单引号之中：

```kt
val capitalA: Char = 'A'
```

但是，不是所有 136690 个字符都能在键盘上找到。因此，你可以使用 Unicode 转义字符序列 \u 再加上 Unicode 字符编码来表示一个字符：

```kt
val unicodeCapitalA: Char = '\u0041'
```

### 截取

#### substring

substring 函数支持 IntRange 类型（表示一个整数范围的类型）的参数。这个 IntRange。

示例:

```kt
val indexOfApostrophe = TAVERN_NAME.indexOf('\'')
val tavernMaster = TAVERN_NAME.substring(0 until indexOfApostrophe)
```

参数表示的范围决定要截取哪些位置的字符。这里，范围是从第一个字符直到撇号之前的字符 （until 创建的范围不包括上限值）。

#### split

split 函数返回的是 List 集合数据。使用给定的分隔符，该函数会返回一系列子字符串。

```kt
val data = menuData.split(',')
val type = data[0]
val name = data[1]
val price = data[2]
```

而 List 集合又支持一种叫解构（destructuring）的语法特性（这个 Kotlin 特性允许你在一个表达式里给多个变量赋值）。所以，如下所示， 我们可以用解构语法来替换一条条的赋值语句。

```kt
val menuData = ...
val (type, name, price) = menuData.split(',')
```

### 字符串操作

#### replace

replace 函数。顾名思义，此函数能按给定规则替换字符串中的 字符。replace 函数支持用正则表达式（稍后会展开讨论）确定要操作哪些字符，然后调用你定 义的匿名函数来确定如何替换匹配字符。

使用的 replace 函数需要两个值参。第一个是正则表达式（regex），用来决定要替换哪些字符。正则表达式可以针对你要搜索的字符定义通用的搜索模式。第二个值参是匿名函数，用来 确定该如何替换正则表达式搜索到的字符。

```kt
phrase.replace(Regex("[aeiou]")) {
  ...
}
```

### 字符串比较

使用结构相等操作符 == 来判断 name 变量值和 "Dragon's Breath" 是否结 构相等。之前，你已见过用 == 判断数值相等的例子。用于字符串时，它会检查两个字符串中的字 符是否都匹配，顺序是否一致。

判断两个变量相等还有另一种方式：引用相等。这种方式会检查两个变量是否引用着同一个 类实例，也就是说两个变量是否指向内存堆上的同一对象。做引用相等判断时使用 === 符号。

引用相等比较很少用于比较字符串。一般来说，相比关心两个字符串是不是同一实例，我们更关心它们是不是相等字符，以及顺序是否一致（或者说两个不同的类实例是否结构相同）。

如果熟悉 Java 语言，那么你就知道，就比较字符串来说，== 操作符的行为方式和 Kotlin 不 一样，Java 用 == 做引用比较。要在 Java 中做结构相等比较，要用 equals 函数。

### 字符串遍历

String 类型还有一些其他函数，可以一次一个地遍历字符串，就像 indexOf 和 split 函数 一样。例如，使用 forEach 函数，你可以打印出小客栈饮料名字的每个字符，一次一个字符。

示例：

```kt
"Dragon's Breath".forEach { println("$it") }
```

许多这类函数也可以用于 List 类型。之后我们将见到大多数可以遍历集合的函数也适用于 String 类型。在很多方面，Kotlin 中 String 类型的行为就像字符集合。

## 字符串模板

字符串模板允许您将变量引用和表达式包含到字符串中。当请求字符串的值时(例如，通过 println) ，所有引用和表达式都被实际值替换。

```kt
val greeting = "Kotliner"

println("Hello $greeting")                  // 1
println("Hello ${greeting.uppercase()}")    // 2
```

1. 打印具有变量引用的字符串。字符串中的引用以 $开头。
2. 用表达式打印一个字符串。表达式以 $开头，用大括号括起来。

## 参考
