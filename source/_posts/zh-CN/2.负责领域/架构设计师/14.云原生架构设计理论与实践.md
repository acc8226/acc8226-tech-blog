---
title: 14. 云原生架构设计理论与实践
date: 2025-09-24 22:45:00
updated: 2025-09-24 22:45:00
categories: [系统架构设计师]
---

## 1 云原生架构产生背景

**云原生技术的重要性**

- 云原生技术是推动业务增长的重要引擎，逐渐在人工智能、大数据、边缘计算、5G 等领域崭露头角。

**云原生技术的优势**

- 云原生技术提供统一的 IaaS 能力和云服务，提升企业 IaaS 层的利用程度。
- 云原生技术促进 DevOps 实现，提高开发周期和效率。<!-- more -->

**云原生技术的挑战**

- 云原生技术需要解决软件的效率和版本更新速度问题。
- 云原生技术需要与现有 IT 架构和流程相融合。

**云原生架构的优势**

1. 支持多场景计算需求
  - 云原生架构支持多种计算场景，满足不同业务需求。
2. 提升业务应用的迭代速度
  - 云原生架构通过 DevSecOps 提升应用的敏捷开发，提高业务应用的迭代速度。
3. 管理数据资产
  - 云原生架构帮助企业更好地管理数据，快速构建数据运营能力。
4. 保障企业安全
  - 云原生架构结合全方位企业级安全服务，保障企业应用在云上安全构建，业务安全运行。

## 2 云原生架构内涵

云原生架构是基于云原生技术的一组架构原则和实践的集合，旨在解决云应用中的非业务代码部分的去中心化问题。

### 2.1 云原生架构定义

1. 云原生架构发生巨大变化
  * 代码结构的巨大变化
    * 云原生架构使得开发人员编写模型发生了巨大变化。今天大部分编程语言中，都有文件、网络、线程等元素，这些元素为充分利用单机资源带来好处，也提升了分布式编程的复杂性。
  * 非功能性特性的大量委托
    * 在云时代，如何获取存储变成了若干服务，包括对象存储服务、块存储服务和具有随机访问的文件存储服务。
    * 企业不再需要掌握各种复杂的事务代码和优化让其变得简单有效。
2. 非功能性特性大量委托
  * 应用部署到云端后，功能性特性和非功能性特性被区分开来。
  * 非功能性特性如业务管理、业务容灾等也是需要业务需求的，非功能性特性是综合业务属性业务价值，但通常是必不可少的属性。
3. 高度自动化的软件交付
  * 软件一旦开发完成，需要在公司内外部各类环境中部署和交付，以将软件价值交给最终客户。
  * 在环境变化时，容器及相关技术则帮助屏蔽不同环境之间的差异。
  * 云原生架构标准化的软件开发交付。

### 2.2 云原生架构原则

云原生架构定义：云原生架构是基于云原生技术的一组架构原则和实践的集合，旨在将云应用中的非业务代码部分进行去中心化剥离。

- 服务化原则：服务化架构将不同生命周期的模块分离出来，避免选代频繁模块慢速模块拖慢，从而加快整体的进度和稳定性。提高软件的复用程度。
- 弹性原则：系统部署规模可以随着业务量的变化而自动伸缩。
- 可观测原则：业务系统的所有活动都清晰可见，便于监控和分析。
- 韧性原则：核心目标是提升软件的平均无故障时间 (Mean Time Between Failure,MTBF)
- 所有过程自动化原则：自动化交付和部署。
- 零信任原则：默认情况下不应该信任网络内部和外部的任何一方。
- 架构持续演进原则：技术演进速度非常快，架构必须适应这种快速变化。

### 2.3 主要架构模式

云原生架构有非常多的架构模式，这里选取一些对应用收益更大的主要架构模式进行讨论。

#### 2.3.1 服务化架构模式

- 服务化架构是云时代构建云应用的标准架构模式，要求以应用模块为颗粒度划分一个软件，以接口契约（例如 IDL）定义彼此业务关系。
- 典型模式是微服务和小服务模式，适用于大型软件系统。

#### 2.3.2 Mesh 化架构模式

- Mesh化架构是云原生组件框架，将中间件框架（如 RPC、缓存、异步消息等）从业务进程中分离。
- 提供更好的安全性和可观测性，按流量进行动态环境隔离、基于流量做冒烟/回归测试。

#### 2.3.3 Serverless 模式

- Serverless 将“部署”动作从运维中“收起”，使开发者不用关心应用运行地点、操作系统、网络配置、CPU 性能等。
- 适合事件驱动的数据计算任务、计算时间短的请求/响应应用、没有复杂相互调用的长周期任务。

#### 2.3.4 存储计算分离模式

分布式环境中的 CAP 问题主要是针对有状态应用，推荐各类暂态数据（如 session）、结构化和非结构化持久数据都采用云服务来保存。

#### 2.3.5 分布式事务模式

微服务模式下，业务需要访问多个微服务，必然带来分布式事务问题。架构师需要根据不同的场景选择合适的分布式事务模式。

#### 2.3.6 可观测架构

- 可观测架构包括 Logging、Tracing、Metrics 三个方面。
- Logging 提供多个级别详细信息跟踪，Tracing 提供请求从前端到后端的完整调用链路跟踪，Metrics 提供系统量化的多维度度量。

#### 2.3.7 事件驱动架构

- 事件驱动架构 (EDA,Event Driven Architecture)是一种应用组件间的集成架构模式，事件具有 schema，可以校验 event 的有效性。
- 增强服务韧性、CQRS、数据变化通知、构建开放接口、流量控制、事件流处理。

### 2.4 典型的云原生架构反模式

1. 庞大的单体应用
  - 单体应用的问题包括缺乏依赖隔离、代码耦合带来的责任不清、模块间接口缺乏治理等。
  - 拆分服务化可以解决这些问题，但需要考虑业务关系、服务模块边界和接口定义。
2. 单体应用“硬拆”为微服务
  - 服务拆分需要适度，过分拆分会导致架构与组织能力不匹配。
  - 拆分后的小规模软件服务拆分、数据依赖和性能降低是常见问题。
3. 缺乏自动化能力的微服务
  - 软件架构复杂度增加，需要重新考虑解决方案。
  - 缺乏自动化能力会导致软件交付时间变长、风险提升和运维成本增加。

## 3 云原生架构相关技术

### 3.1 容器技术

### 3.1.1 容器技术的背景与价值

- 容器技术标准化软件单元，使应用及其依赖项打包，使应用不再受环境限制。
- 容器部署模式与虚拟机比较，容器更轻量、高效。

### 3.1.2 容器编排

Kubernetes 已经成为容器编排的事实标准，被广泛用于自动部署，扩展和管理容器化应用。Kubernetes 提供了分布式应用管理的核心能力。

* 资源调度
* 应用部署与管理
* 自动修复
* 服务发现与负载均衡
* 弹性伸缩
* 声明式 API
* 可扩展性架构
* 可移植性

### 3.2 云原生微服务
